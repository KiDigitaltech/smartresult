<!DOCTYPE html>
<html lang="sw">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>SmartResult - Dashboard </title>
<link rel="icon" type="image/png" href="favicon.png" />
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<style>
  *{box-sizing:border-box;margin:0;padding:0;}
  body{font-family:'Poppins',sans-serif;background:#f0f4f7;color:#333;}
  header{background:linear-gradient(to right,#0d6efd,#00c6ff);color:white;padding:15px 20px;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;}
  header h1{font-size:18px;}
  .hamburger{display:none;font-size:24px;cursor:pointer;}
  .sidebar{position:fixed;top:60px;left:0;width:220px;height:100%;background:#fff;border-right:1px solid #ddd;padding-top:20px;transition:all 0.3s;}
  .sidebar a{display:block;padding:12px 20px;color:#555;text-decoration:none;margin-bottom:5px;border-radius:8px;cursor:not-allowed;background:#eee;}
  .sidebar a.active{background:#0d6efd;color:white;cursor:default;}
  main{margin-left:240px;padding:30px;transition:margin 0.3s;}
  .status-card{background:#fff;padding:25px;border-radius:15px;box-shadow:0 4px 12px rgba(0,0,0,0.05);text-align:center;}
  .status-card h2{color:#ff4d4f;font-size:20px;}
  .status-card p{margin-top:10px;font-size:15px;}
  .pay-btn{margin-top:20px;padding:12px 25px;background:linear-gradient(to right,#0d6efd,#00c6ff);color:white;border:none;border-radius:10px;font-size:16px;cursor:pointer;transition:0.3s;}
  .pay-btn:hover{opacity:0.9;}
  @media(max-width:768px){
    .hamburger{display:block;}
    .sidebar{position:fixed;top:60px;left:-100%;width:70%;height:100%;z-index:999;background:#fff;padding-top:20px;transition:left 0.3s;}
    .sidebar.show{left:0;}
    main{margin-left:0;padding:20px;}
  }
</style>
</head>
<body>
  <header>
    <h1>SmartResult | Dashboard</h1>
    <div class="hamburger" id="hamburger"><i class="fas fa-bars"></i></div>
  </header>

  <div class="sidebar" id="sidebar">
    <a class="active"><i class="fas fa-lock"></i> Dashboard</a>
    <a><i class="fas fa-file-alt"></i> Matokeo</a>
    <a><i class="fas fa-users"></i> Wanafunzi</a>
    <a><i class="fas fa-cog"></i> Mipangilio</a>
  </div>

  <main>
    <div class="status-card">
      <h2>Akaunti Yako Haijawezeshwa!</h2>
      <p>Kwa sasa haujaruhusiwa kutumia mfumo huu kikamilifu. Tafadhali lipa Tsh.10,000 ili ku-activate akaunti yako.</p>
      <button class="pay-btn" id="payBtn">Lipia Sasa</button>
    </div>
  </main>

  <script type="module">
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-auth.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js";
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCJrWJouAt8xDPm5zOTOw1EcpNd997flQ8",
      authDomain: "smartresult-6c09c.firebaseapp.com",
      projectId: "smartresult-6c09c",
      storageBucket: "smartresult-6c09c.appspot.com",
      messagingSenderId: "77722866135",
      appId: "1:77722866135:web:b0328dcc969b3264acbb92",
      measurementId: "G-3W13B73TQS"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

   

    // Hamburger menu
    const hamburger = document.getElementById('hamburger');
    const sidebar = document.getElementById('sidebar');
    hamburger.addEventListener('click',()=>{
      sidebar.classList.toggle('show');
    });

    // Ensure user is logged in and inactive
    onAuthStateChanged(auth, async(user)=>{
      if(!user) location.href="../index.html";
      else{
        const docSnap = await getDoc(doc(db,"users",user.uid));
        if(!docSnap.exists()) location.href="../index.html";
        else if(docSnap.data().role!=="Inactive") location.href="school-dashboard.html";
      }
    });

    // Pay button â†’ popup window
    document.getElementById("payBtn").addEventListener("click",()=>{
      Swal.fire({
        title: 'Uko tayari kulipa?',
        html: 'Tafadhali hakikisha tayari una Tsh.10,000 Katika Simu yako (TIGOPESA/MIX BY YAS,M-PESA,AIRTEL MONEY,HALOPESA,MASTERCARD) Kwaajili ya Kuwezesha Account yako. <br> Bonyeza <strong>Lipia</strong> kuendelea.',
        icon: 'info',
        showCancelButton: true,
        confirmButtonText: 'Lipia',
        cancelButtonText: 'Hapana'
      }).then((result)=>{
        if(result.isConfirmed){
          const width = 500;
          const height = 700;
          const left = (screen.width/2) - (width/2);
          const top = (screen.height/2) - (height/2);
          window.open("https://checkout.clickpesa.com/payment-page?ref=PYP15L647C","_blank",
                      `width=${width},height=${height},top=${top},left=${left},resizable=yes,scrollbars=yes`);
        }
      });
    });

    // Disable sidebar links click
    document.querySelectorAll('.sidebar a:not(.active)').forEach(link=>{
      link.addEventListener('click',(e)=>{
        e.preventDefault();
        Swal.fire("Haijaruhusiwa","Sehemu hii haiwezi kufunguliwa kwa akaunti isiyo active.","warning");
      });
    });
  </script>
</body>
</html>
