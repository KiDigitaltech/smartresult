<!DOCTYPE html>
<html lang="sw">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sajili Wanafunzi - SmartResult</title>
  
 <link rel="icon" type="image/png" href="favicon.png" />
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <!-- Poppins font -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

  <style>
    :root{
      --primary-500:#2563eb;
      --primary-600:#1d4ed8;
      --accent:#ffd54f;
      --sidebar-width:240px;
      --glass: rgba(255,255,255,0.6);
    }

    *{box-sizing:border-box}
    body{
      font-family:'Poppins',sans-serif;
      margin:0;
      background:#f4f7fb;
      color:#111827;
      min-height:100vh;
      display:flex;
      flex-direction:column;
    }

    /* Header */
    header{
      position:fixed;
      top:0;left:0;right:0;
      height:64px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:0 1rem 0 1rem;
      background:linear-gradient(90deg,#3b82f6,var(--primary-500));
      color:white;
      box-shadow:0 3px 8px rgba(37,99,235,0.18);
      z-index:1100;
    }
    header h1{margin:0;font-size:1.15rem;display:flex;align-items:center;gap:.6rem;font-weight:700}
    #sidebarToggle{display:none;background:transparent;border:0;color:white;font-size:1.4rem;cursor:pointer}

    #btnLogout{
      background:transparent;border:1.5px solid rgba(255,255,255,0.18);
      color:white;padding:.45rem .9rem;border-radius:10px;font-weight:700;cursor:pointer;
      display:inline-flex;align-items:center;gap:.5rem;
      transition:all .18s ease;
    }
    #btnLogout:hover{background:white;color:var(--primary-600)}

    /* Layout */
    #container{display:flex;flex:1;margin-top:64px;min-height:calc(100vh - 64px);}

    /* Sidebar */
    #sidebar{
      width:var(--sidebar-width);
      position:fixed;
      left:0;top:64px;
      bottom:0;
      background:linear-gradient(180deg,#1e40af,var(--primary-500));
      color:white;
      padding:1rem 0;
      box-shadow:2px 0 12px rgba(0,0,0,0.08);
      overflow:auto;
      z-index:1050;
      transform:translateX(0);
      transition:transform .28s ease;
    }
    #sidebar nav{display:flex;flex-direction:column;gap:.18rem}
    #sidebar nav a{
      display:flex;align-items:center;gap:.9rem;padding:.95rem 1.2rem;color:inherit;text-decoration:none;
      font-weight:600;border-left:5px solid transparent;border-radius:0 18px 18px 0;margin:0 .6rem;
      transition:all .22s ease;
      white-space:nowrap;
    }
    #sidebar nav a i{width:26px;text-align:center;font-size:1.15rem}
    #sidebar nav a.active,
    #sidebar nav a:hover{
      background:rgba(255,213,79,0.12);
      color:var(--accent);
      border-left-color:var(--accent);
      transform:translateX(4px);
    }

    /* Main content */
    main{
      margin-left:calc(var(--sidebar-width) + 2rem);
      padding:2rem;
      flex:1;
      max-width:1100px;
    }

    /* Card look for main area */
    .card{
      background:white;border-radius:12px;padding:1.6rem;box-shadow:0 10px 30px rgba(2,6,23,0.04);
    }

    h2{margin-top:0;color:#0f172a;font-size:1.125rem}

    /* Forms */
    form label{display:block;margin-bottom:.45rem;font-weight:600;color:#374151}
    input[type="text"], select, input[type="file"]{
      width:100%;padding:.6rem .9rem;border-radius:10px;border:1.25px solid #e6e9ef;font-size:1rem;
      margin-bottom:1rem;transition:box-shadow .18s,border-color .18s;
    }
    input[type="text"]:focus, select:focus, input[type="file"]:focus{
      outline:none;border-color:var(--primary-500);box-shadow:0 6px 22px rgba(37,99,235,0.12);
    }

    .btn-primary{
      background:var(--primary-500);color:white;padding:.6rem 1rem;border-radius:10px;border:0;font-weight:700;
      cursor:pointer;display:inline-flex;align-items:center;gap:.6rem;box-shadow:0 8px 26px rgba(37,99,235,0.12);
      transition:transform .12s ease,box-shadow .12s ease,background .12s;
    }
    .btn-primary:hover{background:var(--primary-600);transform:translateY(-2px)}

    /* Table */
    table{width:100%;border-collapse:collapse;margin-top:1rem;font-size:.95rem}
    thead th{
      text-align:left;padding:.75rem 1rem;background:var(--primary-500);color:white;font-weight:700;border-radius:8px 8px 0 0;
    }
    tbody tr{background:#fff;border-radius:10px;margin-bottom:.6rem;box-shadow:0 6px 18px rgba(2,6,23,0.03)}
    tbody tr td{padding:.9rem 1rem;vertical-align:middle;border-bottom:1px solid rgba(0,0,0,0.03)}
    tbody tr:hover{background:#f1f6ff}

    .actions i{cursor:pointer;margin-right:.6rem;font-size:1.08rem;color:var(--primary-500);transition:color .14s}
    .actions i.delete{color:#ef4444}
    .actions i:hover{transform:scale(1.06)}

    /* Popup message */
    #popupMessage{
      position:fixed;top:78px;right:20px;padding:.85rem 1rem;border-radius:10px;display:flex;align-items:center;gap:.6rem;
      color:white;background:var(--primary-500);box-shadow:0 10px 30px rgba(37,99,235,0.18);
      opacity:0;transform:translateY(-8px);pointer-events:none;transition:opacity .28s,transform .28s;z-index:1200;
    }
    #popupMessage.show{opacity:1;transform:translateY(0);pointer-events:auto}
    #popupMessage .icon{font-size:1.2rem}
    #popupMessage .closeBtn{margin-left:8px;cursor:pointer;font-weight:700}

    /* Loader overlay */
    #loaderOverlay{
      position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.12);
      z-index:1300;backdrop-filter: blur(2px);
    }
    #loaderOverlay.active{display:flex}
    .loader{
      width:56px;height:56px;border-radius:50%;border:6px solid #e6e9ef;border-top-color:var(--primary-500);animation:spin 0.95s linear infinite;
      box-shadow:0 10px 30px rgba(37,99,235,0.12);
    }
    @keyframes spin{to{transform:rotate(360deg)}}

    /* Edit popup (centered modal) */
    #editPopup{
      position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(2,6,23,0.35);z-index:1400;padding:1rem;
    }
    #editPopup .popup{
      width:100%;max-width:520px;background:white;border-radius:12px;padding:1.4rem;box-shadow:0 16px 40px rgba(2,6,23,0.12);
    }
    #editPopup .popup h3{margin-top:0;margin-bottom:1rem}
    #editPopup .close-edit{position:absolute;right:14px;top:12px;cursor:pointer;font-weight:700;color:#374151}

    /* Responsive */
    @media (max-width: 900px){
      main{margin-left:1rem;padding:1rem}
      #sidebar{transform:translateX(-110%);position:fixed}
      #sidebarToggle{display:inline-block}
      body.mobile-menu-active #sidebar{transform:translateX(0)}
    }

    footer{padding:1rem;text-align:center;color:#6b7280;background:transparent;border-top:1px solid rgba(0,0,0,0.03);margin-top:auto}
  </style>
</head>
<body>

<header>
  <button id="sidebarToggle" aria-label="Fungua Menyu" title="Fungua Menyu">
    <i class="fa fa-bars"></i>
  </button>

  <h1><i class="fa-solid fa-school"></i> SmartResult - Sajili Wanafunzi</h1>

  <button id="btnLogout" title="Logout">
    <i class="fa-solid fa-right-from-bracket"></i> Logout
  </button>
</header>

<div id="container">
  <aside id="sidebar" aria-label="Menyu ya Upande">
    <nav aria-label="Main Navigation">
      <a href="school-dashboard.html"><i class="fas fa-tachometer-alt"></i> <span>Dashibodi</span></a>
      <a href="register-students.html" class="active"><i class="fas fa-user-plus"></i> <span>Sajili Wanafunzi</span></a>
      <a href="register-classes.html"><i class="fas fa-chalkboard"></i> <span>Sajili Madarasa</span></a>
      <a href="register-subjects.html"><i class="fas fa-book"></i> <span>Sajili Masomo</span></a>
      <a href="enter-results.html"><i class="fas fa-pen-to-square"></i> <span>Jaza Matokeo</span></a>
      <a href="view-results.html"><i class="fas fa-file-alt"></i> <span>Tazama Matokeo</span></a>
      <a href="subject-results.html"><i class="fas fa-chart-line"></i> <span>Mkeka wa Somo</span></a>
      <a href="average-subjects.html"><i class="fas fa-percentage"></i> <span>Tathmini Somo</span></a>
      <a href="students-report.html"><i class="fas fa-user-graduate"></i> <span>Ripoti</span></a>
      <a href="profile.html"><i class="fas fa-user-cog"></i> <span>Wasifu</span></a>
    </nav>
  </aside>

  <main role="main">
    <section class="card" style="margin-bottom:1.25rem">
      <h2>Sajili Mwanafunzi Mpya</h2>
      <form id="studentForm" autocomplete="off">
        <label for="studentName">Jina Kamili</label>
        <input type="text" id="studentName" placeholder="Jina la mwanafunzi" required />

        <label for="gender">Jinsia</label>
        <select id="gender" required>
          <option value="">-- Chagua jinsia --</option>
          <option value="Me">Me</option>
          <option value="Ke">Ke</option>
        </select>

        <label for="classSelect">Darasa</label>
        <select id="classSelect" required>
          <option value="">-- Chagua darasa --</option>
        </select>

        <div style="display:flex;gap:.75rem;align-items:center">
          <button type="submit" id="btnSubmit" class="btn-primary">
            <i class="fa-solid fa-plus"></i> Sajili
          </button>
          <p id="msg" style="margin:0;color:#6b7280;font-size:.95rem"></p>
        </div>
      </form>
    </section>

    <section class="card" style="margin-bottom:1.25rem">
      <h2>Sajili Wanafunzi kwa Kupakia Excel</h2>
      <form id="uploadForm">
        <input type="file" id="excelFile" accept=".xls,.xlsx" required />
        <div style="margin-top:.6rem">
          <button type="submit" class="btn-primary"><i class="fa-solid fa-file-import"></i> Pakia Excel</button>
          <span id="uploadMsg" style="margin-left:1rem;color:#6b7280"></span>
        </div>
      </form>
    </section>

    <section class="card">
      <h2>Orodha ya Wanafunzi</h2>
      <label for="filterClass">Chagua Darasa Kuona Wanafunzi</label>
      <select id="filterClass" style="max-width:320px;margin-bottom:1rem">
        <option value="">-- Chagua darasa --</option>
      </select>

      <div style="overflow:auto">
        <table id="studentsTable" aria-live="polite">
          <thead>
            <tr>
              <th>Jina Kamili</th>
              <th>Jinsia</th>
              <th>Darasa</th>
              <th>Vitendo</th>
            </tr>
          </thead>
          <tbody>
            <tr><td colspan="4" style="text-align:center;color:#6b7280;padding:1.4rem">Hakuna mwanafunzi</td></tr>
          </tbody>
        </table>
      </div>
    </section>
  </main>
</div>

<footer>
  &copy; 2025 SmartResult. Haki zote zimehifadhiwa.
</footer>

<!-- Loader Overlay -->
<div id="loaderOverlay" aria-hidden="true">
  <div class="loader" role="status" aria-label="Inapakia..."></div>
</div>

<!-- Popup Message -->
<div id="popupMessage" role="status" aria-live="polite">
  <i class="icon fa fa-info-circle" aria-hidden="true"></i>
  <span id="popupText"></span>
  <span class="closeBtn" title="Funga">&times;</span>
</div>

<!-- Edit Popup -->
<div id="editPopup" aria-hidden="true">
  <div class="popup">
    <span class="close-edit" title="Funga" onclick="document.getElementById('editPopup').style.display='none'">&times;</span>
    <h3>Hariri Mwanafunzi</h3>
    <form id="editForm">
      <label for="editStudentName">Jina Kamili</label>
      <input type="text" id="editStudentName" required />

      <label for="editGender">Jinsia</label>
      <select id="editGender" required>
        <option value="">-- Chagua jinsia --</option>
        <option value="Me">Me</option>
        <option value="Ke">Ke</option>
      </select>

      <label for="editClassSelect">Darasa</label>
      <select id="editClassSelect" required>
        <option value="">-- Chagua darasa --</option>
      </select>

      <div style="display:flex;gap:.6rem;margin-top:.6rem">
        <button type="submit" class="btn-primary">Hifadhi Mabadiliko</button>
        <button type="button" onclick="document.getElementById('editPopup').style.display='none'" style="background:#ef4444;color:white;border:0;padding:.6rem 1rem;border-radius:10px;cursor:pointer">Ghairi</button>
      </div>
    </form>
  </div>
</div>

<!-- XLSX (SheetJS) for Excel parsing -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<!-- Firebase and app logic -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
  import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-auth.js";
  import {
    getFirestore, collection, getDoc, getDocs, addDoc, updateDoc, deleteDoc, doc, query, where
  } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js";

  // ---------- CONFIG - keep your config here ----------
  const firebaseConfig = {
    apiKey: "AIzaSyCJrWJouAt8xDPm5zOTOw1EcpNd997flQ8",
    authDomain: "smartresult-6c09c.firebaseapp.com",
    projectId: "smartresult-6c09c",
  };
  const app = initializeApp(firebaseConfig);
  const auth = getAuth();
  const db = getFirestore(app);
  // ---------------------------------------------------

  // Elements
  const studentForm = document.getElementById("studentForm");
  const studentName = document.getElementById("studentName");
  const gender = document.getElementById("gender");
  const classSelect = document.getElementById("classSelect");
  const msg = document.getElementById("msg");
  const loaderOverlay = document.getElementById("loaderOverlay");
  const studentsTableBody = document.querySelector("#studentsTable tbody");
  const filterClass = document.getElementById("filterClass");
  const uploadForm = document.getElementById("uploadForm");
  const excelFile = document.getElementById("excelFile");
  const uploadMsg = document.getElementById("uploadMsg");

  const popupMessage = document.getElementById("popupMessage");
  const popupText = document.getElementById("popupText");
  const popupIcon = popupMessage.querySelector(".icon");
  const popupCloseBtn = popupMessage.querySelector(".closeBtn");

  let classesMap = {};
  let editingStudentId = null;
  let currentUser = null;
  let schoolId = null;

  // Loader helpers
  function showLoader(){ loaderOverlay.classList.add("active"); loaderOverlay.setAttribute("aria-hidden","false"); }
  function hideLoader(){ loaderOverlay.classList.remove("active"); loaderOverlay.setAttribute("aria-hidden","true"); }

  // Popup helper
  function showPopup(text, type = "info"){
    popupText.textContent = text;
    popupMessage.className = ""; // reset
    popupMessage.classList.add("show");
    // set icon & background depending on type
    let iconCls = "fa-info-circle";
    switch(type){
      case "success": iconCls = "fa-circle-check"; popupMessage.style.background = "linear-gradient(90deg,#10b981,#059669)"; break;
      case "error": iconCls = "fa-circle-xmark"; popupMessage.style.background = "linear-gradient(90deg,#ef4444,#dc2626)"; break;
      case "warning": iconCls = "fa-triangle-exclamation"; popupMessage.style.background = "linear-gradient(90deg,#f59e0b,#d97706)"; break;
      default: popupMessage.style.background = "var(--primary-500)";
    }
    popupIcon.className = `icon fa ${iconCls}`;
    clearTimeout(popupMessage._timeout);
    popupMessage._timeout = setTimeout(()=> popupMessage.classList.remove("show"), 4200);
  }
  popupCloseBtn.addEventListener("click", ()=> popupMessage.classList.remove("show"));

  // Load classes into selects
  async function loadClasses(){
    classSelect.innerHTML = '<option value="">-- Chagua darasa --</option>';
    filterClass.innerHTML = '<option value="">-- Chagua darasa --</option>';
    document.getElementById("editClassSelect").innerHTML = '<option value="">-- Chagua darasa --</option>';
    classesMap = {};

    const q = query(collection(db, "classes"), where("schoolId", "==", schoolId));
    const snapshot = await getDocs(q);
    snapshot.forEach(snap => {
      const cls = snap.data();
      const opt = `<option value="${snap.id}">${cls.name}</option>`;
      classSelect.insertAdjacentHTML("beforeend", opt);
      filterClass.insertAdjacentHTML("beforeend", opt);
      document.getElementById("editClassSelect").insertAdjacentHTML("beforeend", opt);
      classesMap[snap.id] = cls.name;
    });
  }

  // Load students
  async function loadStudents(classId = ""){
    studentsTableBody.innerHTML = "";
    showLoader();
    try {
      let q = query(collection(db, "students"), where("schoolId", "==", schoolId));
      if (classId) {
        q = query(collection(db, "students"), where("schoolId", "==", schoolId), where("classId", "==", classId));
      }
      const snapshot = await getDocs(q);
      if (snapshot.empty){
        studentsTableBody.innerHTML = '<tr><td colspan="4" style="text-align:center;color:#6b7280;padding:1.4rem">Hakuna mwanafunzi</td></tr>';
        hideLoader(); return;
      }
      snapshot.forEach(docSnap => {
        const s = docSnap.data();
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${s.name}</td>
          <td>${s.gender}</td>
          <td>${classesMap[s.classId] || "?"}</td>
          <td class="actions">
            <i class="fa fa-edit" title="Hariri" onclick="openEdit('${docSnap.id}')"></i>
            <i class="fa fa-trash delete" title="Futa" onclick="deleteStudent('${docSnap.id}')"></i>
          </td>
        `;
        studentsTableBody.appendChild(tr);
      });
    } catch(err){
      console.error(err);
      showPopup("Kosa kuleta wanafunzi", "error");
    } finally { hideLoader(); }
  }

  // duplicate check
  async function isDuplicateStudent(name, classId){
    const q = query(collection(db, "students"), where("schoolId","==",schoolId), where("name","==",name), where("classId","==",classId));
    const snap = await getDocs(q);
    return !snap.empty;
  }

  // Submit new student
  studentForm.addEventListener("submit", async (e)=>{
    e.preventDefault();
    const nameVal = studentName.value.trim();
    const genderVal = gender.value;
    const classVal = classSelect.value;
    if (!nameVal || !genderVal || !classVal){ showPopup("Tafadhali jaza taarifa zote", "warning"); return; }
    showLoader();
    try {
      if (await isDuplicateStudent(nameVal, classVal)){
        showPopup("Mwanafunzi huyu tayari yupo.", "error"); return;
      }
      await addDoc(collection(db, "students"), { name:nameVal, gender:genderVal, classId:classVal, schoolId, createdAt:new Date() });
      showPopup("Mwanafunzi ameongezwa!", "success");
      studentForm.reset();
      loadStudents(filterClass.value);
    } catch (err){
      console.error(err); showPopup("Kosa la kusajili.", "error");
    } finally { hideLoader(); }
  });

  // Delete
  window.deleteStudent = async function(id){
    if (!confirm("Una uhakika unataka kufuta mwanafunzi huyu?")) return;
    showLoader();
    try {
      await deleteDoc(doc(db, "students", id));
      showPopup("Mwanafunzi amefutwa.", "success");
      loadStudents(filterClass.value);
    } catch (err){
      console.error(err); showPopup("Imeshindikana kufuta.", "error");
    } finally { hideLoader(); }
  };

  // Upload Excel
  uploadForm.addEventListener("submit", async (e)=>{
    e.preventDefault();
    const file = excelFile.files[0];
    if (!file){ showPopup("Chagua faili la Excel", "warning"); return; }
    showLoader();
    const reader = new FileReader();
    reader.onload = async (ev) => {
      try{
        const data = new Uint8Array(ev.target.result);
        const workbook = XLSX.read(data, { type: "array" });
        const sheet = workbook.Sheets[workbook.SheetNames[0]];
        const jsonData = XLSX.utils.sheet_to_json(sheet, { defval: "" });

        let added=0, skipped=0;
        const classNameToId = {};
        for (const id in classesMap) classNameToId[classesMap[id].toLowerCase()] = id;

        for (const row of jsonData){
          const nameVal = (row.name || row.Name || row.Jina || "").toString().trim();
          const genderVal = (row.gender || row.jinsia || "").toString().trim();
          const classNameVal = (row.class || row.darasa || "").toString().trim().toLowerCase();
          const classId = classNameToId[classNameVal];
          if (!nameVal || !genderVal || !classId){ skipped++; continue; }
          if (await isDuplicateStudent(nameVal, classId)){ skipped++; continue; }
          try{
            await addDoc(collection(db, "students"), { name: nameVal, gender: genderVal, classId, schoolId, createdAt: new Date() });
            added++;
          } catch{ skipped++; }
        }
        showPopup(`${added} wameongezwa, ${skipped} wamerukwa.`, "success");
        excelFile.value = "";
        loadStudents(filterClass.value);
      } catch(err){
        console.error(err); showPopup("Kosa kusoma faili la Excel", "error");
      } finally { hideLoader(); }
    };
    reader.readAsArrayBuffer(file);
  });

  // Filter
  filterClass.addEventListener("change", (e)=> loadStudents(e.target.value));

  // Auth state -> load classes & students
  onAuthStateChanged(auth, async (user)=>{
    if (user){
      currentUser = user;
      try{
        const userDoc = await getDoc(doc(db, "users", user.uid));
        if (userDoc.exists()){
          schoolId = userDoc.data().schoolId;
          await loadClasses();
          await loadStudents();
        } else {
          alert("Taarifa za mtumiaji hazijapatikana.");
          location.href = "login.html";
        }
      } catch(err){
        console.error(err); showPopup("Kosa kuanzisha data", "error");
      }
    } else {
      location.href = "login.html";
    }
  });

  // Logout
  document.getElementById("btnLogout").addEventListener("click", () => signOut(auth));

  // EDIT functionality
  const editPopupEl = document.getElementById("editPopup");
  const editForm = document.getElementById("editForm");
  const editStudentName = document.getElementById("editStudentName");
  const editGender = document.getElementById("editGender");
  const editClassSelect = document.getElementById("editClassSelect");

  window.openEdit = async function(id){
    editingStudentId = id;
    showLoader();
    try{
      const docSnap = await getDoc(doc(db, "students", id));
      if (docSnap.exists()){
        const data = docSnap.data();
        editStudentName.value = data.name || "";
        editGender.value = data.gender || "";
        editClassSelect.value = data.classId || "";
        editPopupEl.style.display = "flex";
      } else showPopup("Mwanafunzi haipo", "error");
    } catch(err){ console.error(err); showPopup("Kosa kufungua mhariri", "error"); }
    finally{ hideLoader(); }
  };

  editForm.addEventListener("submit", async (e)=>{
    e.preventDefault();
    const nameVal = editStudentName.value.trim();
    const genderVal = editGender.value;
    const classVal = editClassSelect.value;
    if (!nameVal || !genderVal || !classVal){ showPopup("Tafadhali jaza taarifa zote", "warning"); return; }
    showLoader();
    try{
      await updateDoc(doc(db, "students", editingStudentId), { name: nameVal, gender: genderVal, classId: classVal });
      showPopup("Mabadiliko yametunzwa", "success");
      editPopupEl.style.display = "none";
      loadStudents(filterClass.value);
    } catch(err){ console.error(err); showPopup("Kosa la kuhifadhi mabadiliko", "error"); }
    finally{ hideLoader(); }
  });

  // close edit by clicking backdrop
  editPopupEl.addEventListener("click", (e)=> { if (e.target === editPopupEl) editPopupEl.style.display = "none"; });

</script>

<!-- Sidebar toggle script (non-module, small) -->
<script>
  const sidebarToggle = document.getElementById("sidebarToggle");
  const body = document.body;
  sidebarToggle.addEventListener("click", () => body.classList.toggle("mobile-menu-active"));

  // Auto close sidebar on link click (mobile)
  document.querySelectorAll("#sidebar nav a").forEach(link => {
    link.addEventListener("click", () => { if (window.innerWidth <= 900) body.classList.remove("mobile-menu-active"); });
  });
</script>

</body>
</html>
